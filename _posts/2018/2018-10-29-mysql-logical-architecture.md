---
layout: post
title: 【MySQL高级】逻辑架构和存储引擎
date: 2018-10-29 22:09:24.000000000 +09:00
categories:
- 技术
tags:
- MySQL
toc: true
---

** 
摘要：﻿本篇文章为`MySQL`高级篇系列的开篇，主要是从理论和自身的工作实际出发，去探索高性能的`MySQL` 知识，从基础出发，一步一步构建自己的知识体系。知识主要来自于《高性能MySQL》第三版，官方标准手册以及高级讲师的讲解，自身的业务实践。本篇主要是对整个`MySQL`逻辑架构图的介绍，如果能在头脑中构建出一幅`MySQL`各组件之间如何协同工作的架构图，将非常有助于深入理解`MySQL`服务器的相关知识。最后针对存储引擎`MyISAM`和`InnoDB`的区别进行简要的对比。
![逻辑架构图](https://github.com/LensXiong/hexo_source_code/blob/master/img/technology/2018/mysql-logical-architecture/01.png?raw=true)
**
<!-- more -->
<The rest of contents | 余下全文>

# 逻辑架构图

通过以上`MySQL`逻辑架构图可知，由上到下分为连接层、服务层、引擎层、存储层共四层。

## 连接层

连接层的服务并不是`MySQ`所独有的，大多数基于网络的客户端、服务器的工具或者服务都有类似的架构。

它是一些客户端和连接服务，包含本地`sock`通信和大多数基于客户端/服务端工具实现的类似于`TCP/IP`的通信。

主要完成一些类似于连接处理、授权认证、及相关的安全方案。在该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程。

同样在该层上可以实现基于`SSL`的安全链接。服务器也会为安全接入的每个客户端验证它所具有的操作权限。

## 服务层

服务层的架构主要完成大多数的核心服务功能，包括查询解析、分析、优化、缓存以及所有的内置函数（例如，日期、时间、数学和加密函数）。所有跨存储引擎的功能也在这一层实现，如存储过程、触发器、视图等。

在该层，服务器会解析查询并创建相应的内部解析树，并对其完成相应的优化如确定查询表的顺序，是否利用索引等，最后生成相应的执行操作。

如果是`select`语句，服务器还会查询内部的缓存。如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能。

## 引擎层

存储引擎层，负责`MySQL`中数据的存储和提取，服务器通过`API`与存储引擎进行通信。这些接口屏蔽了不同存储引擎之间的差异，使得这些差异对上层的查询过程透明。不同的存储引擎具有的功能不同，也不会互相通信，而只是简单的响应上层服务器的请求，这样我们可以根据自己的实际需要进行选取。

最常用的存储引擎为`MyISAM`和`InnoDB`。其基本的差别为：

`MyISAM`类型不支持事务处理等高级处理，而`InnoDB`类型支持。`MyISAM`只支持表级锁，`InnoDB`支持行锁。`MyISAM`类型的表强调的是性能，其执行数度比`InnoDB`类型更快，但是不提供事务支持，而`InnoDB`提供事务支持以及外部键等高级数据库功能。

## 存储层

数据存储层，主要是将数据存储在运行于裸设备的文件系统之上，并完成与存储引擎的交互。

简单来讲，`MySQL`四层架构的分层设计思想，特别是插件式的存储引擎架构，将查询处理和其他的系统任务以及数据的存储提取相分离，对于多种不同场景中的应用可以发挥非常好的作用，这种架构可以根据业务的需求和实际的需要选择合适的存储引擎。

# 存储引擎

查看支持的存储引擎：

```
[root@wx mysql] show engines;
```

当前默认的存储引擎：

```
[root@wx mysql] show variables like '%storage_engine%';
```

`MyISAM`和`InnoDB`的区别：

|对比项|MyISAM|InnoDB|
|-| :- | :-: | -: |
|主外键|不支持|支持|
|事务|不支持|支持|
|行表锁|表锁，操作一条记录都会锁表，不适合高并发操作|行锁，操作时只锁某一行，不对其他行有影响，适合高并发的操作|
|缓存|只缓存索引，不缓存真实数据|缓存索引和真实数据，对内存要求较高，内存大小决定性能|
|表空间|小|大|
|关注点|性能|事务|
